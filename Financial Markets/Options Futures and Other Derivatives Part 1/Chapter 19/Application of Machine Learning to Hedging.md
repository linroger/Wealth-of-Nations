---
tags:
  - hedging_strategy
  - machine_learning
  - portfolio_insurance
  - reinforcement_learning
  - trading_costs
aliases:
  - ML hedging
  - derivatives hedging
key_concepts:
  - machine learning hedging
  - portfolio insurance crash
  - sequential decision problems
  - stochastic process simulation
  - transaction trading costs
---

# 19.14 APPLICATION OF MACHINE LEARNING TO HEDGING  

Hedging a position in derivatives involves a sequence of decisions. An initial hedge is chosen and, as the price of the underlying asset changes, further decisions have to be made at later points in time. If there are no transaction costs or other trading frictions, it is optimal to take positions that make the Greek letters equal to zero. But, if there are non-negligible costs associated with trading, the hedger will want to take these into account when developing a hedging strategy.  

Reinforcement learning is the machine learning tool that is used for sequential decision problems. It has been employed to develop software that can play games such as chess and Go better than any human being, and has recently be applied to the problem of hedging derivatives positions when there are transaction/trading costs.13 Reinforcement learning involves specifying an objective function and using a systematic  

On Monday, October 19, 1987, the Dow Jones Industrial Average dropped by more than $20\%$ . Many people feel that portfolio insurance played a major role in this crash. In October 1987 between $\$60$ billion and $\$90$ billion of equity assets were subject to portfolio insurance trading rules where put options were created synthetically in the way discussed in Section 19.13. During the period Wednesday, October 14, 1987, to Friday, October 16, 1987, the market declined by about $10\%$ , with much of this decline taking place on Friday afternoon. The portfolio trading rules should have generated at least $\$12$ billion of equity or index futures sales as a result of this decline. In fact, portfolio insurers had time to sell only $\$4$ billion and they approached the following week with huge amounts of selling already dictated by their models. It is estimated that on Monday, October 19, sell programs by three portfolio insurers accounted for almost $10\%$ of the sales on the New York Stock Exchange, and that portfolio insurance sales amounted to $21.3\%$ of all sales in index futures markets. It is likely that the decline in equity prices was exacerbated by investors other than portfolio insurers selling heavily because they anticipated the actions of portfolio insurers.  

Because the market declined so fast and the stock exchange systems were overloaded, many portfolio insurers were unable to execute the trades generated by their models and failed to obtain the protection they required. Needless to say, the popularity of portfolio insurance schemes has declined significantly since 1987. One of the morals of this story is that it is dangerous to follow a particular trading strategy--even a hedging strategy-- when many other market participants are doing the same thing.  

"trial and error' approach to determine the best strategy. It requires a great deal of data representing different ways the future might unfold. In the case of the hedging decision, a stochastic process can be assumed for the underlying asset's price and the required data can be generated using Monte Carlo simulation.  

The hedger is faced with a trade-off between (a) the expected cost of hedging and. (b) the riskiness of the portfolio. Risks can be reduced, but only by incurring transaction/ trading costs. An objective could be to minimize. $X+c Y$ where $X$ is the expected cost of hedging, $Y$ is the standard deviation of the profit/loss from the hedged portfolio, and $c$ is a constant reflecting the trade-off. Many possible paths for the price of the underlying. asset are simulated. The reinforcement algorithm uses the paths to learn the hedging. strategy that gives an optimal value for the specified objective function..  

# SUMMARY  

Financial institutions offer a variety of option products to their clients. Often the options do not correspond to the standardized products traded by exchanges. The financial institutions are then faced with the problem of hedging their exposure. Naked and covered positions leave them subject to an unacceptable level of risk. One course of action that is sometimes proposed is a stop-loss strategy. This involves holding a naked position when an option is out of the money and converting it to a covered position as soon as the option moves into the money. Although superficially attractive, the strategy does not provide a good hedge.  

The delta $(\Delta)$ of an option is the rate of change of its price with respect to the price of. the underlying asset. Delta hedging involves creating a position with zero delta (some-. times referred to as a delta-neutral position). Because the delta of the underlying asset is 1.0, one way of hedging is to take a position of. $-\Delta$ in the underlying asset for each. long option being hedged. The delta of an option changes over time. This means that the position in the underlying asset has to be frequently adjusted..  

Once an option position has been made delta neutral, the next stage is often to look at its gamma $(\Gamma)$ . The gamma of an option is the rate of change of its delta with respect to the price of the underlying asset. It is a measure of the curvature of the relationship between the option price and the asset price. The impact of this curvature on the performance of delta hedging can be reduced by making an option position gamma neutral. If $\Gamma$ is the gamma of the position being hedged, this reduction is usually. achieved by taking a position in a traded option that has a gamma of. $-\Gamma$  

Delta and gamma hedging are both based on the assumption that the volatility of the underlying asset is constant. In practice, volatilities do change over time. The vega of an option or an option portfolio measures the rate of change of its value with respect to. volatility, often implied volatility. Sometimes the same change is assumed to apply to all implied volatilities. A trader who wishes to hedge an option position against volatility. changes can make the position vega neutral. As with the procedure for creating gamma neutrality, this usually involves taking an offsetting position in a traded option. If the trader wishes to achieve both gamma and vega neutrality, at least two traded options are usually required.  

Two other measures of the risk of an option position are theta and rho. Theta measures the rate of change of the value of the position with respect to the passage of time, with all else remaining constant. Rho measures the rate of change of the value of the position with respect to the interest rate, with all else remaining constant.  

In practice, option traders usually rebalance their portfolios at least once a day to maintain delta neutrality. It is usually not feasible to maintain gamma and vega neutrality on a regular basis. Typically a trader monitors these measures. If they get too large, either corrective action is taken or trading is curtailed.  

Portfolio managers are sometimes interested in creating put options synthetically for. the purposes of insuring an equity portfolio. They can do so either by trading the. portfolio or by trading index futures on the portfolio. Trading the portfolio involves splitting the portfolio between equities and risk-free securities. As the market declines, more is invested in risk-free securities. As the market increases, more is invested in equities. Trading index futures involves keeping the equity portfolio intact and selling index futures. As the market declines, more index futures are sold; as it rises, fewer are sold. This type of portfolio insurance works well in normal market conditions. On. Monday, October 19, 1987, when the Dow Jones Industrial Average dropped very. sharply, it worked badly. Portfolio insurers were unable to sell either stocks or index futures fast enough to protect their positions..  

# FURTHER READING  

Cao, J., J. Chen, J. Hull, and Z. Poulos, "Deep Hedging of Derivatives Using Reinforcement Learning," Journal of Financial Data Science, 3 (Winter 2021): 1-18.   
Hull, J. C. Machine Learning in Business: An Introduction to the World of Data Science, 2nd edn., 2020. Available from Amazon. See: www-2.rotman.utoronto.ca/\~hull.  

Passarelli, D. Trading Option Greeks: How Time, Volatility, and Other Factors Drive Profits, 2nd edn. Hoboken, NJ: Wiley, 2012. Taleb, N. N., Dynamic Hedging: Managing Vanilla and Exotic Options. New York: Wiley, 1996.  

# Short Concept Questions  

19.1. Explain how a stop-loss trading rule is implemented for the writer of an out-of-themoney call option. Why does it provide a poor hedge?.   
19.2. The delta of a call option is 0.7. What does this mean?   
19.3. What is the formula for the delta of a call option on a stock that provides no income?   
19.4. Why does hedging a short call option involve a "buy high, sell low" strategy?.   
19.5. The theta of a call option is $-0.1$ . What does this mean?   
19.6. How is gamma defined?   
19.7. What is the relationship between theta, delta, and gamma when the underlying asset price follows geometric Brownian motion?   
19.8. How is vega defined?   
19.9. What is the delta of (a) a forward contract and (b) a futures contract on an asset that provides no income?   
10 1N Whv did nortfalin incurance not work well on Nctoher 10 10877  

# Practice Questions  

19.11. How can a short position in 1,000 options be made delta neutral when the delta of each option is 0.7?   
19.12. Calculate the delta of an at-the-money six-month European call option on a nondividend-paying stock when the risk-free interest rate is $10\%$ per annum and the stock price volatility is $25\%$ per annum.   
19.13. "The procedure for creating an option position synthetically is the reverse of the. procedure for hedging the option position." Explain this statement.   
19.14. The Black-Scholes-Merton price of an out-of-the-money call option with an exercise price of $\$40$ is $\$4.$ A trader who has written the option plans to use a stop-loss strategy. The trader's plan is to buy at $\$40.10$ and to sell at $\$39.90$ . Estimate the expected number of times the stock will be bought or sold..   
19.15. Suppose that a stock price is currently $\$20$ and that a call option with an exercise price of. $\$25$ is created synthetically using a continually changing position in the stock. Consider the following two scenarios: (a) Stock price increases steadily from $\$20$ to $\$35$ during the life of the option; (b) Stock price oscillates wildly, ending up at $\$35$ . Which scenario would make the synthetically created option more expensive? Explain your answer.   
19.16. What is the delta of a short position in 1,000 European call options on silver futures?. The options mature in 8 months, and the futures contract underlying the option matures in 9 months. The current 9-month futures price is. $\$8$ per ounce, the exercise price of the options is $\$8$ , the risk-free interest rate is. $12\%$ per annum, and the volatility of silver futures prices is $18\%$ per annum.  

19.17. In Problem 19.16, what initial position in 9-month silver futures is necessary for delta hedging? If silver itself is used, what is the initial position? If 1-year silver futures are. used, what is the initial position? Assume no storage costs for silver..  

19.18. A company uses delta hedging to hedge a portfolio of long positions in put and call options on a currency. Which would give the most favorable result: (a) a virtually constant spot rate or (b) wild movements in the spot rate? Explain your answer.  

19.19. Repeat Problem 19.18 for a financial institution with a portfolio of short positions in put and call options on a currency.  

19.20. A financial institution has just sold 1,000 7-month European call options on the Japanese yen. Suppose that the spot exchange rate is 0.80 cent per yen, the exercise price is 0.81 cent per yen, the risk-free interest rate in the United States is $8\%$ per annum, the risk-free interest rate in Japan is $5\%$ per annum, and the volatility of the yen is $15\%$ per annum. Calculate the delta, gamma, vega, theta, and rho of the financial institution's position. Interpret each number.  

19.21. Under what circumstances is it possible to make a European option on a stock index both gamma neutral and vega neutral by adding a position in one other European option?  

19.22. A fund manager has a well-diversified portfolio that mirrors the performance of an index and is worth $\$360$ million. The value of the index is 1,200, and the portfolio manager would like to buy insurance against a reduction of more than $5\%$ in the value of the portfolio over the next 6 months. The risk-free interest rate is $6\%$ per annum. The dividend yield on both the portfolio and the index is $3\%$ , and the volatility of the index is $30\%$ per annum.  

(a) If the fund manager buys traded European put options, how much would the insurance cost?   
(b) Explain carefully alternative strategies open to the fund manager involving traded European call options, and show that they lead to the same result.   
(c) If the fund manager decides to provide insurance by keeping part of the portfolio in risk-free securities, what should the initial position be?   
(d) If the fund manager decides to provide insurance by using 9-month index futures, what should the initial position be?  

19.23. Repeat Problem 19.22 on the assumption that the portfolio has a beta of 1.5. Assume that the dividend yield on the portfolio is. $4\%$ per annum.  

19.24. Show by substituting for the various terms in equation (19.4) that the equation is true for:  

(a) A single European call option on a non-dividend-paying stock.   
(b) A single European put option on a non-dividend-paying stock.   
(c) Any portfolio of European put and call options on a non-dividend-paying stock.  

19.25. What is the equation corresponding to equation (19.4) for (a) a portfolio of derivatives on a currency and (b) a portfolio of derivatives on a futures price?  

19.26. Suppose that $\$70$ billion of equity assets are the subject of portfolio insurance schemes. Assume that the schemes are designed to provide insurance against the value of the assets declining by more than. $5\%$ within 1 year. Making whatever estimates you find. necessary, use the DerivaGem software to calculate the value of the stock or futures contracts that the administrators of the portfolio insurance schemes will attempt to sell if the market falls by $23\%$ in a single day.  

19.27. Does a forward contract on a stock index have the same delta as the corresponding futures contract? Explain your answer..  

19.28. A bank's position in options on the dollar/CAD exchange rate has a delta of 30,000 and a. gamma of $-80{,}000$ . Explain how these numbers can be interpreted. The exchange rate. (dollars per CAD) is 0.90. What position would you take to make the position delta neutral? After a short period of time, the exchange rate moves to 0.93. Estimate the new delta. What additional trade is necessary to keep the position delta neutral? Assuming the bank did set up a delta-neutral position originally, has it gained or lost money from. the exchange rate movement?  

19.29. Use the put-call parity relationship to derive, for a non-dividend-paying stock, the relationship between:  

(a) The delta of a European call and the delta of a European put. (b) The gamma of a European call and the gamma of a European put (c) The vega of a European call and the vega of a European put (d) The theta of a European call and the theta of a European put..  

19.30. A financial institution has the following portfolio of over-the-counter options on sterling:  

<html><body><table><tr><td>Type</td><td>Position</td><td>Delta ofoption</td><td>Gamma ofoption</td><td>Vega ofoption</td></tr><tr><td>Call</td><td>-1,000</td><td>0.50</td><td>2.2</td><td>1.8</td></tr><tr><td>Call</td><td>-500</td><td>0.80</td><td>0.6</td><td>0.2</td></tr><tr><td>Put</td><td>-2,000</td><td>-0.40</td><td>1.3</td><td>0.7</td></tr><tr><td>Call</td><td>-500</td><td>0.70</td><td>1.8</td><td>1.4</td></tr></table></body></html>  

A traded option is available with a delta of 0.6, a gamma of 1.5, and a vega of 0.8.  

(a) What position in the traded option and in sterling would make the portfolio both gamma neutral and delta neutral?   
(b) What position in the traded option and in sterling would make the portfolio both vega neutral and delta neutral? Assume that all implied volatilities change by the same amount so that vegas can be aggregated.  

19.31. Consider again the situation in Problem 19.30. Suppose that a second traded option with a delta of 0.1, a gamma of 0.5, and a vega of 0.6 is available. How could the portfolio be made delta, gamma, and vega neutral?  

19.32. A deposit instrument offered by a bank guarantees that investors will receive a return during a 6-month period that is the greater of (a) zero and (b) $40\%$ of the return provided by a market index. An investor is planning to put $\$100,000$ in the instrument.. Describe the payoff as an option on the index. Assuming that the risk-free rate of interest is $8\%$ per annum, the dividend yield on the index is $3\%$ per annum, and the volatility of. the index is $25\%$ per annum, is the product a good deal for the investor?  

19.33. The formula for the price. $c$ of a European call futures option in terms of the futures price $F_{0}$ is given in Chapter 18 as.  

$$
c=e^{-r T}\left[F_{0}N(d_{1})-K N(d_{2})\right]
$$  

where  

$$
d_{1}=\frac{\ln(F_{0}/K)+\sigma^{2}T/2}{\sigma\sqrt{T}}\mathrm{and}d_{2}=d_{1}-\sigma\sqrt{T}
$$  

and $K,r,T$ and $\sigma$ are the strike price, interest rate, time to maturity, and volatility, respectively.  

(a) Prove that $F_{0}N^{\prime}(d_{1})=K N^{\prime}(d_{2})$   
(b) Prove that the delta of the call price with respect to the futures price is $e^{-r T}N(d_{1})$ (c) Prove that the vega of the call price is. $F_{0}\sqrt{T}\dot{N}^{\prime}(d_{1})e^{-r T}$   
(d) Prove the formula for the rho of a call futures option given in Section 19.12.  

The delta, gamma, theta, and vega of a call futures option are the same as those for a call option on a stock paying dividends at rate $q$ , with $q$ replaced by $r$ and $S_{0}$ replaced by $F_{0}$ Explain why the same is not true of the rho of a call futures option.  

19.34. Use DerivaGem to check that equation (19.4) is satisfied for the option considered in Section 19.1. (Note: DerivaGem produces a value of theta "per calendar day." The theta. in equation (19.4) is "per year.").  

# APPENDIX TAYLOR SERIES EXPANSIONS AND GREEK LETTERS  

A Taylor series expansion of the change in the portfolio value in a short period of time shows the role played by different Greek letters. If the volatility of the underlying asset is assumed to be constant, the value $\Pi$ of the portfolio is a function of the asset price $S$ and time $t$ The Taylor series expansion gives  

$$
\Delta\Pi=\frac{\partial\Pi}{\partial S}\Delta S+{\textstyle\frac{\partial\Pi}{\partial t}}\Delta t+{\textstyle\frac{1}{2}}\frac{\partial^{2}\Pi}{\partial S^{2}}\Delta S^{2}+{\textstyle\frac{1}{2}}\frac{\partial^{2}\Pi}{\partial t^{2}}\Delta t^{2}+\frac{\partial^{2}\Pi}{\partial S\partial t}\Delta S\Delta t+\cdot\cdot\cdot
$$  

where $\Delta\Pi$ and $\Delta S$ are the change in $\Pi$ and $S$ in a small time interval $\Delta t$ Delta hedging eliminates the first term on the right-hand side. The second term is nonstochastic. The third term (which is of order $\Delta t$ ) can be made zero by ensuring that the portfolio is gamma neutral as well as delta neutral. Other terms are of order higher than $\Delta t$  

For a delta-neutral portfolio, the first term on the right-hand side of equation (19A.1) is zero, so that  

$$
\begin{array}{r}{\Delta\Pi=\Theta\Delta t+\frac{1}{2}\Gamma\Delta S^{2}}\end{array}
$$  

when terms of order higher than $\Delta t$ are ignored. This is equation (19.3).  

# The Practitioner Black-Scholes Model  

In practice, volatility is not constant. As explained in this chapter, practitioners usually set volatility equal to implied volatility when calculating Greek letters. From the definition of implied volatility, the option price is an exact function of the asset price,. implied volatility, time, interest rates, and dividends. As an approximation, we can ignore. changes in interest rates and dividends and assume that an option price, $f,$ is at any given time a function of only two variables: the asset price, $S$ and the implied volatility, $\sigma_{\mathrm{imp}}.$ The change in the option price over a short period of time is then given by  

$$
\Delta f={\frac{\partial f}{\partial S}}\Delta S+{\frac{\partial f}{\partial\sigma_{\mathrm{imp}}}}\Delta\sigma_{\mathrm{imp}}+{\frac{1}{2}}{\frac{\partial^{2}f}{\partial S^{2}}}(\Delta S)^{2}+{\frac{1}{2}}{\frac{\partial^{2}f}{\partial\sigma_{\mathrm{imp}}^{2}}}(\Delta\sigma_{\mathrm{imp}})^{2}+{\frac{\partial^{2}f}{\partial S\partial\sigma_{\mathrm{imp}}}}\Delta S\Delta\sigma_{\mathrm{imp}}+\cdots
$$  

Delta, vega, and gamma hedging deal with the first three terms in this expansion (which are the most important ones). Traders sometimes define other Greek letters such as $\partial^{2}f/\partial\sigma_{\mathrm{imp}}^{2}$ and $\partial^{2}f/\partial S\partial\sigma_{\mathrm{imp}}$ to explore their exposure to later terms in the Taylor series.  

When portfolios of options are considered, the trader's problem is more complicated. because the implied volatility of an option on a particular asset depends on the option's. strike price and time to maturity. The trader must consider the portfolio's exposure to the different ways the volatility surface can change over a short period of time. Volatility surfaces are discussed in the next chapter.  

![](8a24463f9c68c6e5365670ae8d54110347457331209e245292b98547551bfe5f.jpg)  

# Volatility Smiles and Volatility Surfaces  

How close are the market prices of options to those predicted by the Black-ScholesMerton model? Do traders really use the Black-Scholes-Merton model when determining a price for an option? Are the probability distributions of asset prices really lognormal? This chapter answers these questions. It explains that traders do use the Black-- Scholes-Merton model--but not in exactly the way that Black, Scholes, and Merton originally intended. This is because they allow the volatility used to price an option to depend on its strike price and time to maturity.  

A plot of the implied volatility of an option with a certain life as a function of its strike. price is known as a volatility smile. A three-dimensional plot of the implied volatility as a function of both strike price and time to maturity is known as a volatility surface. This chapter describes the volatility smiles and volatility surfaces that traders use in equity and foreign currency markets. It explains the relationship between a volatility smile and the. risk-neutral probability distribution being assumed for the future asset price. It also. discusses how traders use volatility surfaces as option-pricing tools..  
